<Window x:Class="OnlineShoeStoreWpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:OnlineShoeStoreWpf"
        mc:Ignorable="d"
        Title="Каталог обуви" Height="800" Width="1500"
        FontFamily="Times New Roman" FontSize="14"
        Background="White">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel x:Name="AdminPanel" Grid.Row="0" HorizontalAlignment="Right" VerticalAlignment="Top" Orientation="Horizontal" Margin="0,20,20,0"/>

        <ListView x:Name="ProductsList" Grid.Row="1" ItemsSource="{Binding Products}" Margin="40" SelectionMode="Single">
            <ListView.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ListView.ItemsPanel>
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border Width="1100" Height="400" Margin="30" 
                            BorderThickness="6" BorderBrush="#7FFF00" CornerRadius="20"
                            Background="White">
                        <!-- Фон по наличию и большой скидке -->
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="BorderBrush" Value="#7FFF00"/>
                                <Setter Property="BorderThickness" Value="6"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsOutOfStock}" Value="True">
                                        <Setter Property="BorderBrush" Value="LightBlue"/>
                                        <Setter Property="BorderThickness" Value="10"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding HasBigDiscount}" Value="True">
                                        <Setter Property="BorderBrush" Value="#2E8B57"/>
                                        <Setter Property="BorderThickness" Value="10"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="350"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Фото слева -->
                            <Image Source="{Binding PhotoPath}" Stretch="Uniform" Margin="30"/>

                            <!-- Правая часть — текст + скидка -->
                            <Grid Grid.Column="1">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Заголовок + скидка справа -->
                                <Grid Grid.Row="0" Margin="20,20,20,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" FontSize="28" FontWeight="Bold" TextWrapping="Wrap">
                                        <Run Text="Категория товара: "/>
                                        <Run Text="{Binding Category.Name}"/>
                                        <Run Text=" | "/>
                                        <Run Text="{Binding Article}"/>
                                    </TextBlock>

                                    <!-- Скидка справа вверху -->
                                    <Border Grid.Column="1" Background="#00FA9A" CornerRadius="30" Padding="30,20"
                                        VerticalAlignment="Top" HorizontalAlignment="Right">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasDiscount}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>

                                        <TextBlock Text="{Binding Discount, StringFormat='Действующая скидка {0}%'}" 
                                            Foreground="Black" FontWeight="Bold" FontSize="20" TextAlignment="Center"/>
                                    </Border>
                                </Grid>

                                <!-- Характеристики -->
                                <StackPanel Grid.Row="1" Margin="20,20,20,20">
                                    <TextBlock Text="{Binding Description, StringFormat='Описание товара: {0}', TargetNullValue='Описание товара: —'}" Margin="0,8"/>
                                    <TextBlock Text="{Binding Manufacturer.Name, StringFormat='Производитель: {0}'}" Margin="0,8"/>
                                    <TextBlock Text="{Binding Supplier.Name, StringFormat='Поставщик: {0}'}" Margin="0,8"/>

                                    <!-- Цена -->
                                    <StackPanel Orientation="Horizontal" Margin="0,15">
                                        <!-- Старая цена — зачёркнутая красным -->
                                        <TextBlock Text="{Binding Price, StringFormat={}{0} руб.}" 
                                            FontSize="20"
                                            TextDecorations="Strikethrough" Foreground="Red">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HasDiscount}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>

                                        <!-- Новая цена -->
                                        <TextBlock Text="{Binding DiscountedPrice, StringFormat={}{0} руб.}" 
                                                   FontSize="26" FontWeight="Bold" Margin="20,0,0,0"/>
                                    </StackPanel>

                                    <TextBlock Text="{Binding Unit, StringFormat='Единица измерения: {0}'}" Margin="0,8"/>
                                    <TextBlock Text="{Binding Quantity, StringFormat='Количество на складе: {0} шт.'}" Margin="0,8"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
</Window>
